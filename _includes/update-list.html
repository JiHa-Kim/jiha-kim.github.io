<!-- Get 5 last posted/updated entries across ALL collections that use layout: post -->

{% assign MAX_SIZE = 5 %}

{%- assign all_list = '' | split: '' -%}

{%- comment -%}
  Collect every outputted doc from every collection whose layout is 'post'.
  (Your hook only adds last_modified_at when layout == 'post', so we mirror that.)
{%- endcomment -%}
{%- for coll in site.collections -%}
  {%- assign docs = coll.docs | where_exp: 'd', 'd.output != false' | where_exp: 'd', 'd.layout == "post"' -%}
  {%- for d in docs -%}
    {%- assign ts = d.last_modified_at | default: d.date | date: '%Y%m%d%H%M%S' -%}
    {%- capture elem -%}{{ ts }}::{{ d.url | relative_url }}::{{ d.title | escape }}{%- endcapture -%}
    {%- assign all_list = all_list | push: elem -%}
  {%- endfor -%}
{%- endfor -%}

{%- assign update_list = all_list | sort | reverse | slice: 0, MAX_SIZE -%}

{%- if update_list.size > 0 -%}
  <section id="access-lastmod">
    <h2 class="panel-heading">{{- site.data.locales[include.lang].panel.lastmod -}}</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      {%- for item in update_list -%}
        {%- assign parts = item | split: '::' -%}
        {%- assign url = parts[1] -%}
        {%- assign title = parts[2] -%}
        <li class="text-truncate lh-lg">
          <a href="{{ url }}">{{ title }}</a>
        </li>
      {%- endfor -%}
    </ul>
  </section>
{%- endif -%}
